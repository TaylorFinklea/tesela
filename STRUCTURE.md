# Tesela Project Structure

This document describes the file structure of the Tesela project and the responsibility of each file and directory.

## Directory Tree

```
tesela/
├── src/                        # Source code
│   ├── main.rs                 # CLI entry point
│   ├── lib.rs                  # Library entry point
│   └── commands.rs             # Command implementations with cross-directory support
├── dailies/                    # Daily notes (when in a mosaic)
├── tests/                      # Test files
│   ├── cli_integration.rs      # Integration tests for CLI
│   └── fixtures/               # Test data and fixtures
├── .cargo/                     # Cargo configuration
│   └── config.toml             # Build configuration (fixes macOS linking)
├── .github/                    # GitHub configuration
│   └── workflows/              # CI/CD workflows
├── target/                     # Build artifacts (git-ignored)
├── Cargo.toml                  # Project manifest
├── Cargo.lock                  # Dependency lock file
├── LICENSE                     # AGPL-3.0 license
├── README.md                   # Project overview and usage
├── STRUCTURE.md                # This file - project structure docs
├── architecture.md             # System architecture documentation
└── plan.md                     # Development roadmap and task tracking
```

## File Responsibilities

### Core Source Files (`src/`)

#### `src/main.rs`
- **Purpose**: CLI application entry point
- **Responsibilities**:
  - Defines the CLI structure using `clap`
  - Parses command-line arguments
  - Routes commands to their implementations
  - Handles error display and exit codes
- **Key Components**:
  - `Cli` struct: Top-level CLI definition
  - `Commands` enum: All available subcommands
  - `main()`: Entry point that dispatches to command handlers

#### `src/lib.rs`
- **Purpose**: Library entry point for the Tesela crate
- **Responsibilities**:
  - Exposes public API for use as a library
  - Re-exports key functions from internal modules
  - Contains library-level documentation
  - Houses unit tests for the library API
- **Key Components**:
  - Module declarations
  - Public re-exports of `init_mosaic`, `create_note`, `list_notes`
  - Unit tests for library functionality

#### `src/commands.rs`
- **Purpose**: Implementation of all CLI commands
- **Responsibilities**:
  - Implements business logic for each command
  - Handles file system operations
  - Manages note creation, listing, and mosaic initialization
  - Provides error handling with detailed context
- **Key Functions**:
  - `init_mosaic(path)`: Creates a new mosaic directory structure with notes/, dailies/, and attachments/
  - `create_note(title)`: Creates a new markdown note with outliner format
  - `daily_note()`: Creates daily notes in dailies/ directory
  - `open_note_in_editor()`: Opens notes from both notes/ and dailies/ directories
  - `search_notes()`: Searches content across both directories with labeling
  - `get_note_names_with_timestamps()`: Scans both directories for autocomplete
  - `find_matching_notes()`: Finds notes with title-to-filename mapping
  - `extract_title_from_content()`: Extracts title from note content
  - `format_time_ago()`: Formats timestamps as human-readable strings
- **Internal Tests**: Contains unit tests for all functions

### Test Files (`tests/`)

#### `tests/cli_integration.rs`
- **Purpose**: End-to-end integration tests for the CLI
- **Responsibilities**:
  - Tests the complete CLI workflow
  - Verifies command outputs and exit codes
  - Tests error conditions and edge cases
  - Ensures proper file creation and modification
- **Test Coverage**:
  - Help and version commands
  - Mosaic initialization
  - Note creation with various titles
  - Note listing and ordering
  - Error handling without mosaic

#### `tests/fixtures/`
- **Purpose**: Test data and fixtures directory
- **Responsibilities**:
  - Stores sample notes for testing
  - Contains test configuration files
  - Provides mock data for tests

### Configuration Files

#### `Cargo.toml`
- **Purpose**: Rust project manifest
- **Responsibilities**:
  - Defines project metadata (name, version, edition)
  - Lists dependencies and their versions
  - Configures binary and library targets
  - Specifies dev-dependencies for testing
- **Key Dependencies**:
  - `clap`: Command-line argument parsing
  - `chrono`: Date and time handling
  - `anyhow`: Error handling
  - `tempfile`: Temporary directories for testing

#### `Cargo.lock`
- **Purpose**: Dependency lock file
- **Responsibilities**:
  - Locks specific versions of all dependencies
  - Ensures reproducible builds
  - Auto-generated by Cargo

#### `.cargo/config.toml`
- **Purpose**: Cargo build configuration
- **Responsibilities**:
  - Fixes macOS linking issues with iconv
  - Configures platform-specific build flags
  - Ensures tests compile on macOS

#### `.github/workflows/`
- **Purpose**: GitHub Actions CI/CD workflows
- **Responsibilities**:
  - Automated testing on push/PR
  - Cross-platform build verification
  - Release automation (future)

### Documentation Files

#### `README.md`
- **Purpose**: Project introduction and quick start
- **Responsibilities**:
  - Project overview and philosophy
  - Installation instructions
  - Basic usage examples
  - Links to other documentation

#### `STRUCTURE.md` (this file)
- **Purpose**: Project structure documentation
- **Responsibilities**:
  - Documents file organization
  - Explains the purpose of each file/directory
  - Helps new contributors understand the codebase

#### `architecture.md`
- **Purpose**: System design documentation
- **Responsibilities**:
  - Documents architectural decisions
  - Explains the overall system design
  - Details the roadmap from v0.1 to v1.4
  - Describes plugin system architecture

#### `plan.md`
- **Purpose**: Development roadmap and task tracking
- **Responsibilities**:
  - Tracks implementation progress
  - Lists features by version
  - Contains detailed task checklists
  - Documents success metrics

#### `LICENSE`
- **Purpose**: Legal license file
- **Responsibilities**:
  - AGPL-3.0 license text
  - Defines usage and distribution terms

## Generated Directories

### `target/`
- **Purpose**: Build output directory (git-ignored)
- **Contents**:
  - `debug/`: Debug build artifacts
  - `release/`: Release build artifacts
  - `deps/`: Compiled dependencies
  - Test executables and intermediate files

## Mosaic Structure (User Data)

When a user runs `tesela init`, it creates:

```
<mosaic-directory>/
├── tesela.toml                # Mosaic configuration
├── notes/                      # Regular markdown notes
│   └── *.md                    # Topic-based note files
├── dailies/                    # Daily notes
│   └── daily-*.md             # Date-based note files
└── attachments/                # File attachments
    └── <files>                 # Images, PDFs, etc.
```

### Note File Structure

Each note in `notes/` and `dailies/` follows the outliner format:

```markdown
---
title: "Note Title"
created: YYYY-MM-DD HH:MM:SS
last_opened: YYYY-MM-DD HH:MM:SS
tags: []
---
-
```

### Block Inheritance

In the outliner format, child blocks inherit properties from parent blocks:

```markdown
---
title: "Project Planning"
tags: ["work"]
---
- Project Alpha #urgent
  - Task 1 (inherits #urgent and "work" tags)
  - Task 2 (inherits #urgent and "work" tags)
- Project Beta
  - Different task (inherits "work" tag only)
```

## Adding New Features

When adding new functionality:

1. **New Commands**: Add to `Commands` enum in `src/main.rs` and implement in `src/commands.rs`
2. **Cross-Directory Support**: Ensure new commands work with both `notes/` and `dailies/` directories
3. **New Modules**: Create new file in `src/` and declare in `src/lib.rs`
4. **Tests**: Add unit tests in the module, integration tests in `tests/`
5. **Documentation**: Update this file and relevant sections of `plan.md`

## Current Features (v0.3.7)

### Cross-Directory Operations
- **Edit**: `tesela -e "partial-name"` searches both directories
- **Search**: `tesela -s "query"` searches all content with directory labels
- **Autocomplete**: Tab completion spans both directories without duplicates
- **Interactive Mode**: All operations work seamlessly across directories

### Outliner Format
- All notes use minimal outliner structure starting with `-`
- Block inheritance for tags and properties
- Future-ready for hierarchical operations and UI development

### Smart Features
- Intelligent autocomplete with title-to-filename mapping
- Time-based ordering of suggestions
- Duplicate detection and resolution
- Cross-directory note discovery

## Development Workflow

1. Make changes to source files
2. Run `cargo build` to compile
3. Run `cargo test` to run all tests
4. Run `cargo clippy` for linting
5. Run `cargo fmt` for formatting
6. Update documentation as needed